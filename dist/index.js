parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"qPoH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TZClient=void 0;var e=require("babel-runtime/core-js/object/assign"),t=b(e),r=require("babel-runtime/core-js/json/stringify"),a=b(r),i=require("babel-runtime/core-js/promise"),n=b(i),s=require("babel-runtime/core-js/array/from"),c=b(s),o=require("bs58check"),h=b(o),l=require("libsodium-wrappers"),d=b(l),u=require("bip39"),p=b(u),_=require("https"),y=b(_),k=require("url"),m=require("crypto"),f=b(m);function b(e){return e&&e.__esModule?e:{default:e}}const g=(e,t)=>new Buffer((0,c.default)(e).concat((0,c.default)(t))),A=(e,t,r)=>new n.default((i,n)=>{const s=new k.URL(e);let c="";const o=y.default.request({method:r,origin:s.origin,host:s.host,path:s.pathname},e=>{e.on("data",e=>{c+=e+""}),e.on("end",()=>{c?i(JSON.parse(c.trim())):n()})});o.on("error",n),"POST"===r&&(o.setHeader("Content-Type","application/json"),o.write((0,a.default)(t))),o.end()}),E=e=>{const t={"00":"parameter","01":"storage","02":"code","03":"False","04":"Elt","05":"Left","06":"None","07":"Pair","08":"Right","09":"Some","0A":"True","0B":"Unit","0C":"PACK","0D":"UNPACK","0E":"BLAKE2B","0F":"SHA256",10:"SHA512",11:"ABS",12:"ADD",13:"AMOUNT",14:"AND",15:"BALANCE",16:"CAR",17:"CDR",18:"CHECK_SIGNATURE",19:"COMPARE","1A":"CONCAT","1B":"CONS","1C":"CREATE_ACCOUNT","1D":"CREATE_CONTRACT","1E":"IMPLICIT_ACCOUNT","1F":"DIP",20:"DROP",21:"DUP",22:"EDIV",23:"EMPTY_MAP",24:"EMPTY_SET",25:"EQ",26:"EXEC",27:"FAILWITH",28:"GE",29:"GET","2A":"GT","2B":"HASH_KEY","2C":"IF","2D":"IF_CONS","2E":"IF_LEFT","2F":"IF_NONE",30:"INT",31:"LAMBDA",32:"LE",33:"LEFT",34:"LOOP",35:"LSL",36:"LSR",37:"LT",38:"MAP",39:"MEM","3A":"MUL","3B":"NEG","3C":"NEQ","3D":"NIL","3E":"NONE","3F":"NOT",40:"NOW",41:"OR",42:"PAIR",43:"PUSH",44:"RIGHT",45:"SIZE",46:"SOME",47:"SOURCE",48:"SENDER",49:"SELF","4A":"STEPS_TO_QUOTA","4B":"SUB","4C":"SWAP","4D":"TRANSFER_TOKENS","4E":"SET_DELEGATE","4F":"UNIT",50:"UPDATE",51:"XOR",52:"ITER",53:"LOOP_LEFT",54:"ADDRESS",55:"CONTRACT",56:"ISNAT",57:"CAST",58:"RENAME",59:"bool","5A":"contract","5B":"int","5C":"key","5D":"key_hash","5E":"lambda","5F":"list",60:"map",61:"big_map",62:"nat",63:"option",64:"or",65:"pair",66:"set",67:"signature",68:"string",69:"bytes","6A":"mutez","6B":"timestamp","6C":"unit","6D":"operation","6E":"address","6F":"SLICE"},r={"00":"int","01":"string","02":"seq","03":["prim",0],"04":["prim",0,!0],"05":["prim",1],"06":["prim",1,!0],"07":["prim",2],"08":["prim",2,!0],"09":["prim",3,!0],"0A":"bytes"};e=e.toUpperCase();let a=0;const i=t=>e.slice(a,a+t),n=()=>{const e=i(2);if(r[e]instanceof Array){a+=2;const s=t[i(2)];return a+=2,{prim:s,args:Array.apply(null,new Array(r[e][1])).map(e=>n())}}if("0A"===e){a+=2;const e=i(8);a+=8;const t=2*parseInt(e,16),r=i(t);return a+=t,{bytes:r}}if("01"===e){a+=2;const e=i(8);a+=8;const t=2*parseInt(e,16),r=i(t);a+=t;const n=new Uint8Array(r.match(/[\dA-F]{2}/g).map(e=>parseInt(e,16)));return{string:new TextDecoder("utf-8").decode(n)}}if("00"===e){a+=2;const e=parseInt(i(2),16).toString(2).padStart(8,"0");a+=2;e[1];const t=[e.slice(2)];let r="1"===e[0];for(;r;){const e=parseInt(i(2),16).toString(2).padStart(8,"0");a+=2,t.push(e.slice(1)),r="1"===e[0]}return{int:parseInt(t.reverse().join(""),2).toString()}}if("02"===e){a+=2;const e=i(8);a+=8;const t=2*parseInt(e,16),r=(i(t),a+t),s=[];for(;r>a;)s.push(n());return s}};return n()},S={contract:new Uint8Array([2,90,121]),identity:new Uint8Array([6,161,159]),public_key:new Uint8Array([13,15,37,217]),secret_key:new Uint8Array([43,246,78,7]),edesk:new Uint8Array([7,90,60,179,41]),signature:new Uint8Array([9,245,205,134,18]),operation:new Uint8Array([5,116])},T={operation:new Uint8Array([3])};class O{constructor(e={}){this.ready=d.default.ready,this.fail_check=n.default.resolve(),this.host=e.host||"https://testnet.tezbridge.com",this.chain_id="main",this.importKey(e)}static enc58(e,t){return h.default.encode(g(e,t))}static dec58(e,t){return h.default.decode(t).slice(e.length)}static r2tz(e){return""+Math.round(1e6*e)}static tz2r(e){return e/1e6+""}static getKeysFromSeed(e){const t=e instanceof Uint8Array?e:O.dec58(S.secret_key,e),r=d.default.crypto_sign_seed_keypair(t);return{public_key:O.enc58(S.public_key,r.publicKey),secret_key:O.enc58(S.secret_key,r.privateKey),public_key_hash:O.enc58(S.identity,d.default.crypto_generichash(20,r.publicKey))}}static genMnemonic(){return p.default.generateMnemonic()}static getSeedFromMnemonic(e,t){return O.enc58(S.secret_key,p.default.mnemonicToSeed(e,t).slice(0,32))}importKey(e){if(this.key_pair={},e.encrypted_seed){const t=O.dec58(S.edesk,e.encrypted_seed),r=t.slice(0,8),a=t.slice(8);return new n.default((t,i)=>{f.default.pbkdf2(e.password,r,32768,32,"sha512",(e,r)=>{e&&i(e);try{const n=d.default.crypto_secretbox_open_easy(a,new Buffer(24),r);this.key_pair=O.getKeysFromSeed(n),t()}catch(e){i(e)}})})}if(e.seed&&(this.key_pair=O.getKeysFromSeed(e.seed)),e.mnemonic&&e.password&&(this.key_pair=O.getKeysFromSeed(O.getSeedFromMnemonic(e.mnemonic,e.password))),e.secret_key){const t=O.dec58(S.secret_key,e.secret_key).slice(32);this.key_pair={secret_key:e.secret_key,public_key:O.enc58(S.public_key,t),public_key_hash:O.enc58(S.identity,d.default.crypto_generichash(20,t))}}return n.default.resolve()}call(e,t={}){return A(this.host+e,t,"GET")}post(e,t={}){return A(this.host+e,t,"POST")}header(){return this.call(`/chains/${this.chain_id}/blocks/head/header`)}head_custom(e){return this.call(`/chains/${this.chain_id}/blocks/head${e}`)}protocol(){return this.header().then(e=>e.protocol)}predecessor(){return this.header().then(e=>e.predecessor)}head_hash(){return this.call(`/chains/${this.chain_id}/blocks/head/hash`)}head(){return this.call(`/chains/${this.chain_id}/blocks/head`)}get_hash_key(e,t){const r=O.dec58(e,t),a=d.default.to_hex(r);return[[0,2],[2,4],[4,6],[6,8],[8,10],[10,void 0]].map(e=>a.slice(e[0],e[1])).join("/")}big_map_with_key(e,t){const r=this.get_hash_key(S.contract,t);return this.call(`/chains/${this.chain_id}/blocks/head/context/raw/bytes/contracts/index/originated/${r}/big_map/${e}`).then(e=>this.decode_bytes(e.data))}raw_storage(e){const t=this.get_hash_key(S.contract,e);return this.call(`/chains/${this.chain_id}/blocks/head/context/raw/bytes/contracts/index/originated/${t}/data/storage`).then(e=>{const r=parseInt(e.slice(0,8),16),a=e.slice(8,8+2*r);return new n.default((e,r)=>{this.call(`/chains/${this.chain_id}/blocks/head/context/raw/bytes/contracts/index/originated/${t}/big_map`).then(t=>{const r={},i=(e,t)=>{for(const a in e)e.data?r[t]=this.decode_bytes(e.data):i(e[a],t+a)};i(t,""),e({storage:this.decode_bytes(a),big_map:r})}).catch(t=>{e({storage:this.decode_bytes(a),big_map:{}})})})})}decode_bytes(e){return E(e)}pack_data(e,t){const r={data:e,type:t,gas:"400000"};return this.post(`/chains/${this.chain_id}/blocks/head/helpers/scripts/pack_data`,r).then(e=>e.packed)}hash_data(e){return n.default.resolve(d.default.to_hex(d.default.crypto_generichash(32,d.default.from_hex(e))))}balance(e){return this.call(`/chains/${this.chain_id}/blocks/head/context/delegates/${e||this.key_pair.public_key_hash}/balance`)}counter(e){return this.call(`/chains/${this.chain_id}/blocks/head/context/contracts/${e||this.key_pair.public_key_hash}/counter`)}counter1(e){return this.counter(e).then(e=>parseInt(e)+1+"")}contract(e){return this.call(`/chains/${this.chain_id}/blocks/head/context/contracts/${e}`)}manager_key(e){return this.call(`/chains/${this.chain_id}/blocks/head/context/contracts/${e||this.key_pair.public_key_hash}/manager_key`)}createOpJSON(e){const r={reveal:{kind:"reveal",source:this.key_pair.public_key_hash,fee:"0",gas_limit:"0",storage_limit:"0",public_key:this.key_pair.public_key},transaction:{kind:"transaction",source:this.key_pair.public_key_hash,fee:"0",gas_limit:"400000",storage_limit:"60000",amount:"0"},origination:{kind:"origination",source:this.key_pair.public_key_hash,fee:"0",gas_limit:"400000",storage_limit:"60000",manager_pubkey:this.key_pair.public_key_hash,balance:"0"}}[e];for(let e=1;e<arguments.length;e++)(0,t.default)(r,JSON.parse((0,a.default)(arguments[e])));return r}makeOpWithReveal(e,t,r){return this.counter1(e).then(a=>this.manager_key(e).then(i=>{const n=[];return i.key||n.push(this.createOpJSON("reveal",{counter:a+++"",source:e})),t.forEach(e=>{n.push(this.createOpJSON(e.kind,e.params,{counter:a+++""}))}),this.makeOperations(n,r)}))}originate(e){const t=e.no_injection;return delete e.no_injection,this.makeOpWithReveal(e.source,[{kind:"origination",params:e}],t)}transfer(e){if(!e.destination)return n.default.reject("lack of destination when calling transfer");const t=e.no_injection;return delete e.no_injection,this.makeOpWithReveal(e.source,[{kind:"transaction",params:e}],t)}activate(e){return this.makeOperations([{kind:"activate_account",secret:e,pkh:this.key_pair.public_key_hash}])}makeOperations(e,r){return e=e.map(e=>(["fee","balance","amount"].forEach(t=>{"number"==typeof e[t]&&(e[t]=O.r2tz(e[t]))}),["gas_limit","storage_limit"].forEach(t=>{"number"==typeof e[t]&&(e[t]=e[t]+"")}),e)),this.head_hash().then(r=>{const a={branch:r,contents:e};return n.default.all([a,this.protocol(),this.post(`/chains/${this.chain_id}/blocks/head/helpers/forge/operations`,(0,t.default)(a))]).then(([e,t,r])=>{const a=d.default.crypto_sign_detached(d.default.crypto_generichash(32,g(T.operation,d.default.from_hex(r))),O.dec58(S.secret_key,this.key_pair.secret_key)),i=r+d.default.to_hex(a);return e.protocol=t,e.signature=O.enc58(S.signature,a),n.default.all([this.post(`/chains/${this.chain_id}/blocks/head/helpers/preapply/operations`,[e]),i])})}).then(([e,t])=>{const a=[].concat.apply([],e.map(e=>e.contents.map(e=>e.metadata.operation_result))).filter(e=>e);if(a.filter(e=>"applied"!==e.status).length)return n.default.reject(e);const i=a.map(e=>e.originated_contracts||[]);return n.default.all([i,r?null:this.post("/injection/operation",t)])}).then(([e,t])=>({contracts:e,operation_id:t}))}}exports.TZClient=O,O.libs={bs58check:h.default,sodium:d.default,bip39:p.default};
},{}],"Focm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getApiClient=void 0;var e=require("babel-runtime/helpers/asyncToGenerator"),t=p(e),r=require("babel-runtime/core-js/promise"),s=p(r),i=require("./tzclient.js"),n=require("tezexchange-api"),o=p(n),d=require("readline"),l=p(d),u=require("stream"),c=p(u);function p(e){return e&&e.__esModule?e:{default:e}}const y=(e,t)=>new s.default((r,s)=>{const i=l.default.createInterface({input:process.stdin,output:process.stdout});console.log(e),i.question("",e=>{i.close(),r(e)}),t&&(i._writeToOutput=function(e){i.output.write("")})}),a=exports.getApiClient=(()=>{var e=(0,t.default)(function*({version:e,secret_key:t,encrypted_seed:r}){const s=new i.TZClient;if(yield s.ready,t)yield s.importKey({secret_key:t});else if(r){const e=yield y("Password:",!0);yield s.importKey({encrypted_seed:r,password:e})}else{const e=yield y("Using unencrypted key(1) or encrypted seed(2):");if(1==e){const e=yield y("Unencrypted key(edsk):",!0);yield s.importKey({secret_key:e})}else if(2==e){const e=yield y("Encrypted Seed(edesk):",!0),t=yield y("Password:",!0);yield s.importKey({encrypted_seed:e,password:t})}}return console.log("=== KEY IMPORTED ==="),new o.default(s,null,e)});return function(t){return e.apply(this,arguments)}})();exports.default={getApiClient:a};
},{"./tzclient.js":"qPoH"}]},{},["Focm"], null)
//# sourceMappingURL=/index.map